---
phase: 02-path-construction-audit
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/storage/skill-store.ts
  - src/safety/audit-logger.ts
  - src/safety/operation-cooldown.ts
  - src/safety/file-lock.ts
  - src/capabilities/collector-agent-generator.ts
autonomous: true
requirements:
  - PATH-01
  - PATH-03
  - PATH-04
  - PATH-05

must_haves:
  truths:
    - "All constructor default paths use path.join() instead of string literals with forward slashes"
    - "Existing tests pass unchanged after path.join() substitution (behavioral equivalence)"
    - "PATH-05 (import.meta.url) is documented as already satisfied — no code changes needed"
    - "Platform-adapter.ts tilde strings confirmed as display-only labels, not fs API inputs"
  artifacts:
    - path: "src/storage/skill-store.ts"
      provides: "SkillStore constructor with path.join default"
      contains: "join('.claude', 'skills')"
    - path: "src/safety/audit-logger.ts"
      provides: "AuditLogger constructor with path.join default"
      contains: "join('.claude', '.audit-log.jsonl')"
    - path: "src/safety/operation-cooldown.ts"
      provides: "OperationCooldown constructor with path.join default"
      contains: "join('.claude', '.cooldown-state.json')"
    - path: "src/safety/file-lock.ts"
      provides: "FileLock constructor with path.join default"
      contains: "join('.claude', '.skill-creator.lock')"
    - path: "src/capabilities/collector-agent-generator.ts"
      provides: "CollectorAgentGenerator constructor with path.join default"
      contains: "join('.claude', 'agents')"
  key_links:
    - from: "src/storage/skill-store.ts"
      to: "src/validation/path-safety.ts"
      via: "assertSafePath receives skillsDir resolved path"
      pattern: "assertSafePath.*resolve"
---

<objective>
Replace all hardcoded forward-slash constructor default paths with `path.join()` equivalents across the storage, safety, and capabilities layers. Document PATH-05 and PATH-04 platform-adapter findings as already satisfied.

Purpose: Constructor defaults like `'.claude/skills'` use forward slashes which may cause path comparison mismatches when `path.resolve()` produces backslash paths on Windows. Using `path.join()` ensures platform-native separators.

Output: 5 files updated with `path.join()` constructor defaults, PATH-05 verified as pre-satisfied.
</objective>

<execution_context>
@C:/Users/Myke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Myke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-path-construction-audit/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace constructor default paths with path.join() in storage and safety layers</name>
  <files>
    src/storage/skill-store.ts
    src/safety/audit-logger.ts
    src/safety/operation-cooldown.ts
    src/safety/file-lock.ts
    src/capabilities/collector-agent-generator.ts
  </files>
  <action>
For each file, replace the hardcoded forward-slash string default with a `path.join()` call. Add `join` to the existing `path` import (or add a new import from `'path'` if none exists).

**src/storage/skill-store.ts** (line 92):
- Change: `constructor(private skillsDir: string = '.claude/skills')`
- To: `constructor(private skillsDir: string = join('.claude', 'skills'))`
- `join` is already imported from `'path'` on line 3

**src/safety/audit-logger.ts** (line 64):
- Change: `constructor(logPath: string = '.claude/.audit-log.jsonl')`
- To: `constructor(logPath: string = join('.claude', '.audit-log.jsonl'))`
- Add `join` to existing import: `import { dirname, join } from 'path';`

**src/safety/operation-cooldown.ts** (line 58):
- Change: `constructor(config: CooldownConfig, statePath: string = '.claude/.cooldown-state.json')`
- To: `constructor(config: CooldownConfig, statePath: string = join('.claude', '.cooldown-state.json'))`
- `join` is already imported from `'path'` on line 13

**src/safety/file-lock.ts** (line 67):
- Change: `constructor(lockPath: string = '.claude/.skill-creator.lock')`
- To: `constructor(lockPath: string = join('.claude', '.skill-creator.lock'))`
- Add `join` to existing import: `import { dirname, join } from 'path';`

**src/capabilities/collector-agent-generator.ts** (line 47):
- Change: `constructor(private outputDir: string = '.claude/agents')`
- To: `constructor(private outputDir: string = join('.claude', 'agents'))`
- Add new import: `import { join } from 'path';`

Follow project conventions: use named import `{ join }` from `'path'`, not `'node:path'` (match existing import style in each file).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors introduced. Run `npx vitest run` to verify all existing tests pass.
  </verify>
  <done>
All 5 constructor defaults use `path.join()`. TypeScript compiles cleanly. All existing tests pass unchanged (behavioral equivalence confirmed).
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify and document PATH-04 (platform-adapter) and PATH-05 (import.meta.url) as pre-satisfied</name>
  <files>
    .planning/STATE.md
  </files>
  <action>
**PATH-05 verification:** Research confirmed all 10 `import.meta.url` occurrences already use `fileURLToPath()` or `createRequire()`. No raw `.pathname` access exists. Run a grep to re-confirm: search for `import.meta.url` across the codebase and verify none use `.pathname`.

**PATH-04 verification:** Research confirmed `src/portability/platform-adapter.ts` PLATFORMS registry tilde strings (`'~/.claude/skills'`) are display labels only, not passed to fs APIs. The actual fs-ready path comes from `getSkillsBasePath()` in `src/types/scope.ts` which correctly uses `join(homedir(), '.claude', 'skills')`. Verify by grepping `platform-adapter.ts` for any `readFile`, `writeFile`, `mkdir`, `readdir`, `stat`, or other fs API calls that receive tilde strings.

**Update STATE.md:**
- In "Blockers/Concerns", resolve the `platform-adapter.ts` tilde strings concern (mark as resolved with finding)
- In "Decisions", add: `[02-01]: PATH-05 verified pre-satisfied — all import.meta.url uses already wrapped in fileURLToPath()`
- In "Decisions", add: `[02-01]: PATH-04 platform-adapter tilde strings confirmed display-only — no fs API usage`
  </action>
  <verify>
Grep for `import.meta.url` — zero instances of raw `.pathname` access. Grep `platform-adapter.ts` for fs API imports — none found that consume tilde strings.
  </verify>
  <done>
PATH-04 and PATH-05 verified as pre-satisfied with evidence. STATE.md updated with resolved concerns and decisions.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npx vitest run` passes all existing tests
3. Grep for `= '\.claude/` in `src/` returns zero matches (no remaining hardcoded forward-slash constructor defaults)
4. Grep for `import.meta.url` confirms zero raw `.pathname` access
</verification>

<success_criteria>
- All constructor default paths in storage, safety, and capabilities layers use `path.join()`
- Zero hardcoded forward-slash path defaults remain in constructor signatures
- PATH-04 and PATH-05 documented as pre-satisfied with verification evidence
- All existing tests pass unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/02-path-construction-audit/02-01-SUMMARY.md`
</output>
