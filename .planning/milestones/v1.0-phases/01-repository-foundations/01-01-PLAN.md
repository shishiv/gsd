---
phase: 01-repository-foundations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [.gitattributes]
autonomous: true
requirements: [REPO-01]

must_haves:
  truths:
    - "All text files in the repository are stored with LF line endings in the Git index"
    - "Windows clones check out LF (not CRLF) in the working directory"
    - "YAML skill files parse without trailing \\r characters on Windows"
    - "Shell scripts in scripts/ execute in Git Bash without \\r errors"
    - "Vitest snapshot files are stable across Linux and Windows"
  artifacts:
    - path: ".gitattributes"
      provides: "Repository-level LF line-ending policy"
      min_lines: 15
      contains: "* text=auto eol=lf"
  key_links:
    - from: ".gitattributes"
      to: "Git index"
      via: "git add --renormalize ."
      pattern: "text=auto eol=lf"
---

<objective>
Create `.gitattributes` with LF line-ending enforcement and renormalize all tracked files.

Purpose: Prevent CRLF corruption on Windows clones — YAML, JSON, shell scripts, and snapshot files must all use LF line endings in both the Git index and the working directory. This is the prerequisite for all subsequent Windows compatibility work.

Output: `.gitattributes` file committed, all tracked files renormalized to LF in two atomic commits.
</objective>

<execution_context>
@C:/Users/Myke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Myke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-repository-foundations/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create .gitattributes with LF enforcement rules</name>
  <files>.gitattributes</files>
  <action>
Create `.gitattributes` in the repository root with this exact structure:

1. **Blanket rule** — `* text=auto eol=lf` — forces LF in both the index AND working directory on all platforms. CRITICAL: Use `text=auto eol=lf`, NOT `text=auto` alone (which would check out CRLF on Windows).

2. **Explicit overrides** for files that break on CRLF (belt-and-suspenders per user decision):
   - `*.yml text eol=lf`
   - `*.yaml text eol=lf`
   - `*.json text eol=lf`
   - `*.sh text eol=lf`
   - `*.snap text eol=lf`

3. **Binary exceptions** — no line-ending translation (per user decision):
   - `*.png binary`
   - `*.jpg binary`
   - `*.gif binary`
   - `*.ico binary`
   - `*.woff binary`
   - `*.woff2 binary`
   - `*.ttf binary`
   - `*.eot binary`

Add brief comments for each section explaining purpose. Per user decision on Claude's Discretion, order is: blanket rule → explicit overrides → binary exceptions.

Commit as: `chore(repo): add .gitattributes for LF line endings`
  </action>
  <verify>
- File `.gitattributes` exists in repo root
- Contains `* text=auto eol=lf` as the blanket rule
- Contains explicit `eol=lf` overrides for yml, yaml, json, sh, snap
- Contains binary markers for png, jpg, gif, ico, woff, woff2, ttf, eot
- `git show HEAD:.gitattributes` displays the file content from the commit
  </verify>
  <done>.gitattributes committed with blanket LF rule, explicit overrides for sensitive types, and binary exceptions</done>
</task>

<task type="auto">
  <name>Task 2: Renormalize all tracked files to LF</name>
  <files>.gitattributes</files>
  <action>
Run the renormalization sequence to apply the new `.gitattributes` rules to all existing tracked files:

1. **Pre-check** — Run `git ls-files --eol | head -20` to observe current line-ending state before renormalization.

2. **Inspect fixture files** — Check `git ls-files --eol` output for any files in `src/orchestrator/__fixtures__/` or test fixtures that might contain intentional CRLF. If found, note them but proceed (research confirmed no intentional CRLF expected).

3. **Renormalize** — Run `git add --renormalize .` to re-stage all tracked files with the new line-ending rules.

4. **Commit** — Commit as: `chore(repo): normalize line endings to LF`

   Per user decision: accept the large diff — it is a one-time event and clearly attributable.

5. **Post-check** — Run `git ls-files --eol | head -20` to verify all text files now show `i/lf w/lf` (LF in both index and working tree).

6. **Snapshot check** — Research confirmed no `.snap` files currently exist in the repo (Glob returned no results). Verify this is still true. If any `.snap` files exist, run `npx vitest run` to regenerate them, then commit: `test(snapshots): regenerate after line-ending normalization`.

NOTE: Do NOT skip the renormalization commit. `.gitattributes` rules only apply to future `git add` operations — existing indexed files retain old line endings until renormalized.
  </action>
  <verify>
- `git log --oneline -2` shows two commits: the renormalization commit and the .gitattributes commit
- `git ls-files --eol` shows `i/lf` for all text files in the index
- `git diff --check HEAD` reports no whitespace errors
- No `.snap` files appear in `git status` as modified (either none exist, or they were regenerated and committed)
  </verify>
  <done>All tracked files renormalized to LF; index and working tree both show LF for all text files; renormalization committed as a separate atomic commit</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `git log --oneline -3` shows the two new commits (plus prior HEAD)
2. `git ls-files --eol` confirms `i/lf w/lf attr/text=auto eol=lf` for representative files (pick 3: a .ts file, a .yml file, a .json file)
3. `git diff --check HEAD~2..HEAD` reports no whitespace issues across both commits
4. `.gitattributes` contains `* text=auto eol=lf` as the first non-comment line
</verification>

<success_criteria>
- `.gitattributes` exists with correct blanket LF rule
- All tracked files renormalized (no CRLF in index)
- Two clean commits in history
- Windows clones will receive LF in working directory
</success_criteria>

<output>
After completion, create `.planning/phases/01-repository-foundations/01-01-SUMMARY.md`
</output>
