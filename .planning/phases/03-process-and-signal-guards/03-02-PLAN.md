---
phase: 03-process-and-signal-guards
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/terminal/launcher.ts
autonomous: true
requirements:
  - PROC-03

must_haves:
  truths:
    - "Importing src/terminal/launcher.ts on Windows does not throw"
    - "The SIGKILL escalation in shutdownWetty still force-terminates processes on all platforms"
    - "The code explicitly documents Windows behavior of child.kill('SIGKILL')"
  artifacts:
    - path: "src/terminal/launcher.ts"
      provides: "Platform-documented SIGKILL escalation with Windows-safe comment"
      contains: "Windows"
  key_links:
    - from: "src/terminal/launcher.ts"
      to: "child.kill('SIGKILL')"
      via: "try/catch with platform-aware comment"
      pattern: "child\\.kill\\('SIGKILL'\\)"
---

<objective>
Verify and document that `child.kill('SIGKILL')` in `launcher.ts` is Windows-safe, and add an explicit platform-aware comment to satisfy PROC-03's requirement for a guarded SIGKILL path.

Purpose: `child.kill('SIGKILL')` on Windows is mapped by Node.js to `TerminateProcess()` — it does NOT throw. The existing try/catch already handles the ESRCH case. PROC-03 requires the code to be explicitly guarded/documented so the Windows behavior is clear to future maintainers. This is a verification + documentation task, not a behavioral change.

Output: `launcher.ts` with explicit Windows-behavior documentation in the SIGKILL escalation path; all existing tests pass.
</objective>

<execution_context>
@C:/Users/Myke/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Myke/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-process-and-signal-guards/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add platform-aware SIGKILL documentation and guard comment in launcher.ts (PROC-03)</name>
  <files>src/terminal/launcher.ts</files>
  <action>
In `shutdownWetty()`, update the SIGKILL escalation block (lines 154-159) to explicitly document Windows behavior:

**Before:**
```typescript
escalationTimer = setTimeout(() => {
  try {
    child.kill('SIGKILL');
  } catch {
    // Process may have already exited between SIGTERM and SIGKILL
  }
}, gracePeriodMs);
```

**After:**
```typescript
escalationTimer = setTimeout(() => {
  try {
    // On Windows, Node.js maps SIGKILL to TerminateProcess() — force-terminates
    // the child without a POSIX signal. This is safe and does not throw.
    // On Unix, SIGKILL sends signal 9 (uncatchable immediate kill).
    child.kill('SIGKILL');
  } catch {
    // Process may have already exited between SIGTERM and SIGKILL (ESRCH)
  }
}, gracePeriodMs);
```

Also update the module JSDoc (lines 1-8) to note Windows compatibility:

**Before:**
```typescript
/**
 * Wetty process launcher and graceful shutdown.
 *
 * Spawns Wetty as a child process using config from Phase 123,
 * tracks process lifecycle state, and provides graceful shutdown
 * with SIGTERM -> timeout -> SIGKILL escalation.
 *
 * @module terminal/launcher
 */
```

**After:**
```typescript
/**
 * Wetty process launcher and graceful shutdown.
 *
 * Spawns Wetty as a child process, tracks process lifecycle state,
 * and provides graceful shutdown with SIGTERM -> timeout -> SIGKILL
 * escalation. Windows-safe: child.kill('SIGKILL') maps to
 * TerminateProcess() via Node.js (does not throw).
 *
 * @module terminal/launcher
 */
```

Do NOT remove the SIGKILL call. Do NOT add a `process.platform` branch that changes behavior — SIGKILL via `child.kill()` is correctly handled on all platforms by Node.js. The goal is documentation, not behavioral change.
  </action>
  <verify>Run `npx vitest run src/terminal/launcher.test.ts` — all existing tests pass. Verify the file imports cleanly: `node -e "import('./dist/terminal/launcher.js')"` (if dist exists) or simply check TypeScript compiles: `npx tsc --noEmit src/terminal/launcher.ts`.</verify>
  <done>launcher.ts SIGKILL escalation is explicitly documented as Windows-safe; module JSDoc updated; all tests pass; no behavioral changes.</done>
</task>

</tasks>

<verification>
1. `npx vitest run src/terminal/launcher.test.ts` — all launcher tests pass
2. `grep -n "Windows" src/terminal/launcher.ts` — Windows documentation present in both module JSDoc and SIGKILL block
3. `grep -n "child.kill('SIGKILL')" src/terminal/launcher.ts` — SIGKILL call still present (not removed)
4. No new dependencies added
</verification>

<success_criteria>
- launcher.ts module JSDoc documents Windows SIGKILL mapping
- SIGKILL escalation block has inline comment explaining Windows behavior
- Existing try/catch remains (guards ESRCH for already-exited processes)
- All launcher tests pass
- No behavioral changes — only documentation
</success_criteria>

<output>
After completion, create `.planning/phases/03-process-and-signal-guards/03-02-SUMMARY.md`
</output>
